<!-- student/templates/student/dashboard.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard — Student</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/student.css') }}">
</head>
<body>
  <header class="topbar">
    <h1>UAP — Student Dashboard</h1>
    <div class="nav">
      <span>Hi, {{ profile.name }}</span>
      <a href="{{ url_for('student_bp.logout') }}">Logout</a>
    </div>
  </header>

  <main class="container">
    <section class="profile card">
      <h2>Profile</h2>
      <p><strong>Registration:</strong> {{ profile.registration_number }}</p>
      <p><strong>Roll:</strong> {{ profile.roll_number }}</p>
      <p><strong>Department:</strong> {{ profile.department }}</p>
      <p><strong>Session:</strong> {{ profile.session_start }} - {{ profile.session_end }}</p>
    </section>

    <section class="card">
      <h2>Semester Registration</h2>
      {% if registration_open %}
        <form id="regForm" method="post" action="{{ url_for('student_bp.semester_register') }}">
          <label>Semester</label>
          <input name="semester" required>
          <div id="subjects">
            <div class="subject-row">
              <input name="subject_name[]" placeholder="Subject name" required>
              <input name="subject_code[]" placeholder="Code (optional)">
              <input name="subject_dept[]" placeholder="Department (optional)">
              <button type="button" class="remove">-</button>
            </div>
          </div>
          <button type="button" id="addSubject">Add subject</button>
          <button type="submit">Submit Registration</button>
        </form>
      {% else %}
        <p>Semester registration is currently closed.</p>
      {% endif %}
    </section>

    <section class="card">
      <h2>Attendance</h2>
      <table class="attendance-table">
        <thead><tr><th>Date</th><th>Subject</th><th>Faculty</th><th>Status</th></tr></thead>
        <tbody>
          {% for a in attendance %}
            <tr>
              <td>{{ a.date.strftime("%Y-%m-%d") if a.get('date') else (a.get('timestamp') and a.timestamp.strftime("%Y-%m-%d") ) }}</td>
              <td>{{ a.subject_name or a.get('subject') }}</td>
              <td>{{ a.faculty_name or a.get('faculty_reg_no') }}</td>
              <td>{{ a.status }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4">No attendance records found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <section class="card">
      <h2>Assignments</h2>
      <ul>
        {% for asg in assignments %}
          <li>
            <strong>{{ asg.title }}</strong> — {{ asg.subject }} — due {{ asg.due_date or "N/A" }}
            <div>{{ asg.description }}</div>
            <div>Status: <em>{{ asg.status }}</em></div>
          </li>
        {% else %}
          <li>No assignments.</li>
        {% endfor %}
      </ul>
    </section>
  </main>

  <script src="{{ url_for('static', filename='js/student.js') }}"></script>
</body>
</html>
